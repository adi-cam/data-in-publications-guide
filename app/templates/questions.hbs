<div class="sub-nav-wrapper">
  <div class="sub-nav">
    {{#each this.data.questionTopics as |topic index|}}
      <LinkTo class="sub-nav__item" @route="questions" @query={{hash page=(add index 1)}}>
        {{topic}}
      </LinkTo>

      <Icons::NavDivider />
    {{/each}}

    <LinkTo class="sub-nav__item" @route="questions" @query={{hash page="rec"}}>
      Recommendations
    </LinkTo>
  </div>
</div>

{{#if (eq this.page "rec")}}
  <div class="page">
    <ul class="sidebar" {{highlight linkSelector="li a" elementSelector="h2"}}>
      {{#each-in this.filteredGroupedRecommendations as |topic|}}
        <li>
          <a href="#{{slug topic}}" {{link-inline}}>
            {{topic}}
          </a>
        </li>
      {{/each-in}}
    </ul>

    <h2 class="title1 title1__capped">
      {{#if this.application.title}}
        Recommendations for your publication "{{this.application.title}}"
      {{else}}
        Your Recommendations
      {{/if}}
    </h2>

    <div class="icon-button" role="button" {{on "click" this.print}}>
      <Icons::Print />
      <span>Print Page</span>
    </div>

    <div class="icon-button" role="button" {{on "click" this.share}}>
      <Icons::Link />
      <span>Share Page</span>
    </div>

    {{#each-in this.filteredGroupedRecommendations as |topic recommendations|}}
      <div class="section">
        <h2
          role="button"
          class="title2 title2__button"
          id={{slug topic}}
          {{on "click" (fn this.openAll recommendations)}}
        >
          <span>{{topic}}</span>
          <span class="title2__small">Open All</span>
        </h2>

        {{#each recommendations as |recommendation|}}
          <div class="group">
            {{#let (get this.state recommendation.id) as |open|}}
              <h3
                role="button"
                class="title3 title3__capped title3__button"
                {{on "click" (fn this.open recommendation.id (not open))}}
              >
                <span>{{recommendation.title}}</span>

                {{#if open}}
                  <Icons::ChevronUp />
                {{else}}
                  <Icons::ChevronDown />
                {{/if}}
              </h3>

              {{#if open}}
                <p>
                  {{#if recommendation.advanced}}
                    <strong>Basic</strong>:
                  {{/if}}

                  {{recommendation.basic}}
                </p>

                {{#if recommendation.advanced}}
                  <p>
                    <strong>Advanced</strong>:
                    {{recommendation.advanced}}
                  </p>
                {{/if}}

                {{#if recommendation.resources}}
                  <h4 class="title4">
                    Resources
                  </h4>

                  {{#each recommendation.resources as |resource|}}
                    <p>
                      <a href={{resource.link}} target="_blank" rel="noopener noreferrer">
                        <Icons::External />
                        <strong>{{resource.title}}</strong>
                      </a><br />
                      {{resource.short}}
                    </p>
                  {{/each}}
                {{/if}}

                {{#if recommendation.contacts}}
                  <h4 class="title4">
                    Contacts
                  </h4>

                  {{#each recommendation.contacts as |contact|}}
                    <p>
                      <a href="mailto:{{contact.link}}" rel="noopener noreferrer">
                        <Icons::External />
                        <strong>{{contact.title}}</strong>
                      </a><br />
                      {{contact.short}}
                    </p>
                  {{/each}}
                {{/if}}

                {{#if recommendation.examples}}
                  <h4 class="title4">
                    Examples
                  </h4>

                  {{#each recommendation.examples as |example|}}
                    <p>
                      <a href={{example.link}} target="_blank" rel="noopener noreferrer">
                        <Icons::External />
                        <strong>{{example.title}}</strong>
                      </a><br />
                      {{example.short}}
                    </p>
                  {{/each}}
                {{/if}}
              {{/if}}
            {{/let}}
          </div>
        {{/each}}
      </div>
    {{/each-in}}
  </div>
{{else}}
  <div class="page">
    <h1 class="title1 title1__capped">
      {{get this.data.questionTopics (sub this.page 1)}}
    </h1>

    {{#each (get this.filteredGroupedQuestions (get this.data.questionTopics (sub this.page 1))) as |question|}}
      <div class="question">
        <h2 class="title2 title2__capped">
          {{question.title}}
        </h2>

        <p class="large">
          {{question.desc}}
        </p>

        {{#if (eq question.format "text")}}
          <p>
            <label>
              <input
                type="text"
                class="input"
                name={{question.id}}
                placeholder="Publication Title"
                value={{this.title}}
                {{on "change" this.setTitle}}
              />
            </label>
          </p>
        {{else if (or (eq question.format "multiple") (eq question.format "single"))}}
          <div class="controls">
            {{#each question.options as |option|}}
              <div>
                {{#if (eq question.format "multiple")}}
                  <div
                    role="checkbox"
                    class="checkbox {{if (get this.answers option.id) 'checked'}}"
                    aria-checked={{get this.answers option.id}}
                    {{on "click" (fn this.toggleAnswer question.id option.id (not (get this.answers option.id)))}}
                  >
                    {{option.title}}
                  </div>
                {{else if (eq question.format "single")}}
                  <div
                    role="radio"
                    class="radio {{if (eq (get this.answers question.id) option.id) 'checked'}}"
                    aria-checked={{eq (get this.answers question.id) option.id}}
                    {{on "click" (fn this.setAnswer question.id option.id)}}
                  >
                    {{option.title}}
                  </div>
                {{/if}}
              </div>
            {{/each}}
          </div>
        {{/if}}
      </div>
    {{else}}
      <div class="question">
        <p class="large">
          No questions here, please continue.
        </p>
      </div>
    {{/each}}

    <div class="buttons">
      {{#if (gt this.page 1)}}
        <button type="button" class="button" {{on "click" (queue (scroll-top) (fn (mut this.page) (sub this.page 1)))}}>
          Prev
        </button>
      {{else}}
        <span></span>
      {{/if}}

      {{#if (gt this.data.questionTopics.length this.page)}}
        <button
          type="button"
          class="button button__primary"
          {{on "click" (queue (scroll-top) (fn (mut this.page) (add this.page 1)))}}
        >
          Next
        </button>
      {{else}}
        <LinkTo @route="questions" @query={{hash page="rec"}} class="button button__primary">
          Get Recommendations
        </LinkTo>
      {{/if}}
    </div>
  </div>
{{/if}}